<!DOCTYPE html>
<html>
<title>Square game</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
	body {font-family: "Lato", sans-serif}
	#instructions-container {
		width: 100%;
		height: 100px; 
		margin-top: 50px;
		background-color: red;
	}
	
	#game-container {
 		width: 100%;
 		height: auto; 
 		background-color: pink;
	}
</style>
<body>

<script type="text/javascript">

	var directions=[];
	var obstacle=1;
	var emptySlot=0;
	var mySquare=99;
	var finishLine=666;
	var isObstacleHit=false;
	var movesToMakeArrayOfArrays=[];
	var currentPositionition=[];
	function PrintInstructions(directions) {
		var instructionsContainer = document.getElementById("instructions-container");
		instructionsContainer.innerHTML = "";

		for (var i = 0; i < directions.length; i++) {
			instructionsContainer.innerHTML+="<span>"+directions[i]+"</span>"+" ";
		}
	}

	function PressButton(direction) {
		directions.push(direction);
		PrintInstructions(directions);
	}

	
	function ClearGameplay(){
		var gameContainer = document.getElementById("game-container");
		for (var i = gameContainer.childNodes.length - 1; i >= 0; i--) {
			gameContainer.removeChild(gameContainer.childNodes[i]);
		}
	}

	function GetCurrentPositionition(levelArray){
		for (var i = 0; i < levelArray.length; i++) {
			for (var j = 0; j < levelArray[i].length; j++) {
				if (levelArray[i][j] == mySquare) {
					var position = [i, j];
					return position;
				}
			}
		}
	}

	function SetCurrentPositionVariable(Row,Column){
		currentPosition[0]=Row;
		currentPosition[1]=Column;
	}

	function MoveSquare(direction, levelArray){
		currentPosition = GetCurrentPositionition(levelArray);
		var currentRow = currentPosition[0];
		var currentCol = currentPosition[1];
		var isReachedFinishLine=false;
		switch(direction){
			case 'right':
			if (levelArray.length >= currentCol+1 && levelArray[currentRow][currentCol+1]!=obstacle) {
				if (levelArray[currentRow][currentCol+1]==finishLine) {
					isReachedFinishLine=true;
				}
				levelArray[currentRow][currentCol] = 0;
				levelArray[currentRow][currentCol+1] = mySquare;
				SetCurrentPositionVariable(currentRow, currentCol+1);
				return isReachedFinishLine;
			}
			else {
				isObstacleHit=true;
			} 
			break;

			case 'left':
			if ((currentCol-1) >= 0 && levelArray[currentRow][currentCol-1]!=obstacle) {
				if (levelArray[currentRow][currentCol-1]==finishLine) {
					isReachedFinishLine=true;
				}
				levelArray[currentRow][currentCol]=0;
				levelArray[currentRow][currentCol-1] = mySquare;
				SetCurrentPositionVariable(currentRow, currentCol-1);
				return isReachedFinishLine;
			}
			else {
				isObstacleHit=true;
			}
			break;

			case 'up':
			if (currentRow-1>=0 && levelArray[currentRow-1][currentCol]!=obstacle) {
				if (levelArray[currentRow-1][currentCol]) {
					isReachedFinishLine=true;
				}
				levelArray[currentRow][currentCol]=0;
				levelArray[currentRow-1][currentCol] = mySquare;
				SetCurrentPositionVariable(currentRow-1, currentCol);
				return isReachedFinishLine;
			}
			else {
				isObstacleHit=true;
			}
			break;

			case 'down':
			if (levelArray.length>currentRow+1 && levelArray[currentRow+1][currentCol]!=obstacle) {
				if (levelArray[currentRow+1][currentCol]) {
					isReachedFinishLine=true;
				}
				levelArray[currentRow][currentCol] = 0;
				levelArray[currentRow+1][currentCol] = mySquare;
				SetCurrentPositionVariable(currentRow+1, currentCol);
				return isReachedFinishLine;
			}
			else {
				isObstacleHit=true;
			}
			break;
		}
	}

	function copyArrayByValue(oldArray){
		var newArray=[];
		for (var i = 0; i < oldArray.length; i++)
	    {
	    	newArray.push(oldArray[i].slice());
	    }
	    return newArray;
	}

	function GlowCurrentDirection(directionIndex){
		debugger;
		var instructionsContainer = document.getElementById("instructions-container");
		var spansInsideContainer=instructionsContainer.querySelectorAll("span");
		for (var i = 0; i < spansInsideContainer.length; i++) {
			spansInsideContainer[i].style.color="black";
		}
		spansInsideContainer[directionIndex].style.color="yellow";
	}

	function GlowCurrentDirectionTimeout(directionIndex, milliseconds){
		setTimeout(GlowCurrentDirection, milliseconds, directionIndex);
	}

	function StartProgram() {
		for (var i = 0; i < directions.length; i++) {
			ClearGameplay();
			var isReachedFinishLine=MoveSquare(directions[i], firstLevelArray);
			if (!isObstacleHit) {
				GlowCurrentDirectionTimeout(i, i*2000);
			}
			var isWin=false;
				if (isReachedFinishLine && (i+1) == directions.length) {
					isWin=true;
				}
		movesToMakeArrayOfArrays.push(copyArrayByValue(firstLevelArray));
		RenderGameplayTimeout(movesToMakeArrayOfArrays[i], i*2000);
		if (isObstacleHit) {
			alert("You lose :(");
			return;
		}
	}
		if (isWin) {
			alert("You win!");
		}
		else{
			alert("You lose :(");
		}
}
</script>


<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-black w3-card-2">
    <a href="#" class="w3-bar-item w3-button w3-padding-large" onclick="PressButton('up')">/\</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large w3-hide-small" onclick="PressButton('right')">></a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large w3-hide-small" onclick="PressButton('down')">V</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large w3-hide-small" onclick="PressButton('left')">&lt;</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large w3-hide-small" onclick="StartProgram()">Start</a>
  </div>
</div>
<div id="instructions-container">
	
</div>
<div id="game-container">

</div>
<script type="text/javascript">
			//emptySlot - you can walk over it
			//obstacle - you can't walk over it
			//mySquare - my square that I should move
			//finishLine - you win
	function RenderGameplay(levelArray) {
		var gameContainer = document.getElementById("game-container");
			ClearGameplay();
		for (var i = 0; i < levelArray.length; i++) {
			for (var j = 0; j < levelArray[i].length; j++) {
			var innerDiv = document.createElement("div");
				innerDiv.style.width = "50px";
				innerDiv.style.height = "50px";
				innerDiv.style.margin = "4px";
				innerDiv.style.display="inline-block";
				if (levelArray[i][j] == emptySlot) {
					innerDiv.style.backgroundColor ="#66ff33"; 
				}
				else if (levelArray[i][j] == obstacle){
					innerDiv.style.backgroundColor = "black";
				}
				else if (levelArray[i][j] == mySquare){
					innerDiv.style.backgroundColor ="red";
				}
				else if (levelArray[i][j] == finishLine) {
					innerDiv.style.backgroundColor="white";
				}
				gameContainer.appendChild(innerDiv);
				if ((j+1) == levelArray[i].length) {
					var brTag = document.createElement("BR");
					gameContainer.appendChild(brTag);
				}
			}
		}
	}

	function RenderGameplayTimeout(levelArray, milliseconds){
		setTimeout(RenderGameplay, milliseconds, levelArray);
	}

	var firstLevelArray=[
			[emptySlot, emptySlot, obstacle, emptySlot, emptySlot, emptySlot],
			[obstacle, emptySlot, obstacle, emptySlot, emptySlot, obstacle],
			[obstacle, emptySlot, obstacle, mySquare, emptySlot, emptySlot],
			[obstacle, emptySlot, obstacle, emptySlot, emptySlot, emptySlot],
			[obstacle, emptySlot, obstacle, obstacle, emptySlot, finishLine]
	];
	
	RenderGameplay(firstLevelArray);
</script>
</body>
</html>
